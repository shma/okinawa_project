"use strict";function initMap(){Cesium.BingMapsApi.defaultKey="Ar0B0yEfBTt6pqUyvlE2ARKYOl7wti2Klk04EVMBZE0mA8B5cKcm4ILrZPi2P2bd";var e=new google.maps.StreetViewService,i="";$("#waveform").hide(),$(".btn-play").hide(),$(".btn-return").hide();var a,o=WaveSurfer.create({container:"#waveform",waveColor:"black",progressColor:"white",height:200}),t=(a=navigator.userAgent).indexOf("iPhone")>0||a.indexOf("iPod")>0||a.indexOf("Android")>0&&a.indexOf("Mobile")>0?"sp":a.indexOf("iPad")>0||a.indexOf("Android")>0?"tab":"other",n=40;"sp"==t&&(n=20);var r=new Cesium.Viewer("cesium"),s=r.scene,d=r.baseLayerPicker.viewModel.imageryProviderViewModels[11],l=r.baseLayerPicker.viewModel.imageryProviderViewModels[0];r.baseLayerPicker.viewModel.selectedImagery=d;var c=[];function u(e,i,a,o,t,n,r,s){this.label=e,this.label_en=i,this.mp3=a,this.lat=o,this.lng=t,this.heading=n,this.pitch=r,this.range=s}function m(a){a.id.fov;var n=a.id.position._value;p=n;var s=a.id.heading;s;a.id.pitch,a.id.roll,a.id.photoUrl,a.id.fov;!function(a){f.innerHTML=null;var t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(p),n=new google.maps.LatLng(Cesium.Math.toDegrees(t.latitude),Cesium.Math.toDegrees(t.longitude)),s={enableCloseButton:!1,addressControl:!1,panControl:!0,panControlOptions:{position:google.maps.ControlPosition.TOP_CENTER},zoomControl:!1};e.getPanoramaByLocation(n,200,function(e,o){o!=google.maps.StreetViewStatus.OK?(svNotAvailable.innerHTML="この場所のストリートビューは利用できません",fadeInOut(svNotAvailable,1),setTimeout("fadeInOut(svNotAvailable,0)",1500)):($("#cesium").fadeOut(2800),$("#foot").fadeOut(2800),(i=new google.maps.StreetViewPanorama(f,{position:e.location.latLng,pov:{heading:a,pitch:15,zoom:1}})).setOptions(s),i.setVisible(!0))}),$(".btn-return").on("click",function(){$("#waveform").hide(),$(".btn-return").hide(),$("#foot").fadeIn("slow"),$("#cesium").fadeIn("slow"),o.pause(),r.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(127.9029728,25.8057773,7e4),orientation:{pitch:Cesium.Math.toRadians(-50)}})}),$(".btn-play").on("click",function(){o.play()})}(s),$("#wavedesc").text(a.id.name),$("#wavedesc_en").text(a.id.name_en),$("#waveform").show(),o.load("/audio/"+a.id.file),o.on("ready",function(){o.play()}),o.on("finish",function(){$("#waveform").hide(),$(".btn-return").hide(),$(".btn-play").hide(),$("#foot").fadeIn("slow"),$("#cesium").fadeIn("slow"),o.pause(),r.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(127.9029728,25.8057773,8e4),orientation:{pitch:Cesium.Math.toRadians(-50)}})}),$(".btn-return").show(),"sp"==t&&$(".btn-play").show()}c[0]=new u("2012年11月27日18:10録音, 嘉手納, F15戦闘機","recorded 13:30 November 27 2012 at Kadena, F15","2012_kadena_f15_2.mp3",26.3677948,127.7739129,190.6,5,10),c[1]=new u("2012年11月28日16:00録音, 森川公園","recorded 16:00 November 28, 2012 at Morikawa Park","2012_morikawa_ch46.mp3",26.2713147,127.7407946,155.77,5,10),c[2]=new u("2015年11月24日18:15録音, 新城, オスプレイ","recorded 18:15 November 24, 2015 at Arashiro, MV22","151124_arashiro_osprey.mp3",26.2857332,127.7718912,142.19,5,10),c[3]=new u("2016年1月5日10:40録音, 兼久","recorded 10:40 January 5, 2016 at Kaneku","160105_kaneku_kodomo.mp3",26.3547976,127.7420361,259.47,5,10),c[4]=new u("2016年1月5日18:10録音, 上大謝名, オスプレイ","recorded 18:10 January 5, 2016 at Ue-Ojana, MV-22","160105_ueojana_osprey.mp3",26.2629626,127.7402643,107.43,5,10),c[5]=new u("2016年8月9日19:23録音、高江、MV-22 オスプレイ","recorded 19:23 August 9th 2016 at Takae, MV-22 Osprey","160809_arakawa_zuku_osprey.mp3",26.6799939,128.242844,215.29,5,10),c[6]=new u("2017年3月30日15:40録音、砂辺、戦闘機","recorded 15:40 March 30th 2017 at Sunabe, Fighters","170330_sunabepark.mp3",26.3334472,127.7453168,35.32,5,10),$("#toptitle").delay(0).velocity("fadeIn",{duration:1e3}).velocity("fadeOut",{duration:2e3}).velocity({complete:function(){$("#intro").fadeOut(),r.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(135.9029728,24.6757773,16e5),orientation:{pitch:Cesium.Math.toRadians(-50)},complete:function(){r.camera.flyTo({duration:5,destination:Cesium.Cartesian3.fromDegrees(127.9029728,15.6757773,16e5),orientation:{pitch:Cesium.Math.toRadians(-50)},complete:function(){r.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(127.9029728,25.8057773,73e3),orientation:{pitch:Cesium.Math.toRadians(-50)},complete:function(){r.dataSources.add(Cesium.GeoJsonDataSource.load("/json/base.json",{stroke:Cesium.Color.BLACK,fill:Cesium.Color.BLACK.withAlpha(.7),strokeWidth:1})),$("#intro").delay(3e3).velocity("fadeIn",{duration:1500}).velocity({complete:function(){setTimeout(function(){r.baseLayerPicker.viewModel.selectedImagery=l},100)}}),$("#desc3").delay(3e3).velocity("fadeIn",{duration:1500}).delay(3e3).velocity("fadeOut",{duration:1500}).velocity({complete:function(){$("#intro").fadeOut(),$("#head").velocity("fadeIn",{duration:1500}),$("#foot").velocity("fadeIn",{duration:1500}),setTimeout(function(){c.map(function(e,i){r.entities.add({id:i,name:e.label,name_en:e.label_en,file:e.mp3,heading:e.heading,position:Cesium.Cartesian3.fromDegrees(e.lng,e.lat,e.range),type:"noise",point:{color:Cesium.Color.RED.withAlpha(.4),pixelSize:n,translucencyByDistance:new Cesium.NearFarScalar(150,1,15e6,.2)}})})},1e3)}})}})}})}})}}),new Cesium.ScreenSpaceEventHandler(r.canvas).setInputAction(function(e){var i=s.pick(e.position);if(null!=i)if("noise"==i.id.type){i.id.position._value;$(".cesium-infoBox").css("display","none"),r.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(c[i.id.id].lng,c[i.id.id].lat,1e3),complete:function(){r.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(c[i.id.id].lng,c[i.id.id].lat,20),orientation:{heading:Cesium.Math.toRadians(c[i.id.id].heading),pitch:Cesium.Math.toRadians(c[i.id.id].pitch)},complete:function(){m(i)}})}})}else $(".cesium-infoBox").show()},Cesium.ScreenSpaceEventType.LEFT_DOWN);var f=document.getElementById("sv"),p={x:0,y:0,x:0};$(document).on("click",".about",function(){return $("#about").fadeIn(),!1}),$("#about").on("click",function(){return $("#about").fadeOut(),!1})}