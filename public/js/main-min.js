"use strict";function initMap(){Cesium.BingMapsApi.defaultKey="Ar0B0yEfBTt6pqUyvlE2ARKYOl7wti2Klk04EVMBZE0mA8B5cKcm4ILrZPi2P2bd";var e=new google.maps.StreetViewService,i="";$("#waveform").hide(),$(".btn-play").hide(),$(".btn-return").hide();var a,n=WaveSurfer.create({container:"#waveform",waveColor:"black",progressColor:"white",height:200}),o=(a=navigator.userAgent).indexOf("iPhone")>0||a.indexOf("iPod")>0||a.indexOf("Android")>0&&a.indexOf("Mobile")>0?"sp":a.indexOf("iPad")>0||a.indexOf("Android")>0?"tab":"other",t=40;"sp"==o&&(t=20);var r=new Cesium.Viewer("cesium"),s=r.scene,d=r.baseLayerPicker.viewModel.imageryProviderViewModels[11],l=r.baseLayerPicker.viewModel.imageryProviderViewModels[0];r.baseLayerPicker.viewModel.selectedImagery=d,$("#toptitle").delay(0).velocity("fadeIn",{duration:1e3}).velocity("fadeOut",{duration:2e3}).velocity({complete:function(){$("#intro").fadeOut(),r.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(135.9029728,24.6757773,16e5),orientation:{pitch:Cesium.Math.toRadians(-50)},complete:function(){r.camera.flyTo({duration:5,destination:Cesium.Cartesian3.fromDegrees(127.9029728,15.6757773,16e5),orientation:{pitch:Cesium.Math.toRadians(-50)},complete:function(){r.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(127.9029728,25.8057773,73e3),orientation:{pitch:Cesium.Math.toRadians(-50)},complete:function(){r.dataSources.add(Cesium.GeoJsonDataSource.load("/json/base.json",{stroke:Cesium.Color.BLACK,fill:Cesium.Color.BLACK.withAlpha(.7),strokeWidth:1})),$("#intro").delay(3e3).velocity("fadeIn",{duration:1500}).velocity({complete:function(){setTimeout(function(){r.baseLayerPicker.viewModel.selectedImagery=l},100)}}),$("#desc3").delay(3e3).velocity("fadeIn",{duration:1500}).delay(3e3).velocity("fadeOut",{duration:1500}).velocity({complete:function(){$("#intro").fadeOut(),$("#head").velocity("fadeIn",{duration:1500}),$("#foot").velocity("fadeIn",{duration:1500}),setTimeout(function(){r.entities.add({id:0,name:"2012年11月27日18:10録音, 嘉手納, F15戦闘機",name_en:"recorded 13:30 November 27 2012 at Kadena, F15",file:"2012_kadena_f15_2.mp3",heading:190.6,position:Cesium.Cartesian3.fromDegrees(127.7739129,26.3677948,300),type:"noise",point:{color:Cesium.Color.RED.withAlpha(.4),pixelSize:t,translucencyByDistance:new Cesium.NearFarScalar(150,1,15e6,.2)}}),r.entities.add({id:1,name:"2012年11月28日16:00録音, 森川公園",name_en:"recorded 16:00 November 28, 2012 at Morikawa Park",file:"2012_morikawa_ch46.mp3",heading:155.77,position:Cesium.Cartesian3.fromDegrees(127.7407946,26.2713147,300),type:"noise",point:{color:Cesium.Color.RED.withAlpha(.4),pixelSize:t,translucencyByDistance:new Cesium.NearFarScalar(150,1,15e6,.2)}}),r.entities.add({id:3,name:"2015年11月24日18:15録音, 新城, オスプレイ",name_en:"recorded 18:15 November 24, 2015 at Arashiro, MV22",file:"151124_arashiro_osprey.mp3",heading:142.19,position:Cesium.Cartesian3.fromDegrees(127.7718912,26.2857332,300),type:"noise",point:{color:Cesium.Color.RED.withAlpha(.4),pixelSize:t,translucencyByDistance:new Cesium.NearFarScalar(150,1,15e6,.2)}}),r.entities.add({id:4,name:"2016年1月5日10:40録音, 兼久",name_en:"recorded 10:40 January 5, 2016 at Kaneku",file:"160105_kaneku_kodomo.mp3",heading:259.47,position:Cesium.Cartesian3.fromDegrees(127.7420361,26.3547976,300),type:"noise",point:{color:Cesium.Color.RED.withAlpha(.4),pixelSize:t,translucencyByDistance:new Cesium.NearFarScalar(150,1,15e6,.2)}}),r.entities.add({id:6,name:"2016年1月5日18:10録音, 上大謝名, オスプレイ",name_en:"recorded 18:10 January 5, 2016 at Ue-Ojana, MV-22",file:"160105_ueojana_osprey.mp3",heading:107.43,position:Cesium.Cartesian3.fromDegrees(127.7402643,26.2629626,300),type:"noise",point:{color:Cesium.Color.RED.withAlpha(.4),pixelSize:t,translucencyByDistance:new Cesium.NearFarScalar(150,1,15e6,.2)}}),r.entities.add({id:7,name:"2016年8月9日19:23録音、高江、MV-22 オスプレイ",name_en:"recorded 19:23 August 9th 2016 at Takae, MV-22 Osprey",file:"160809_arakawa_zuku_osprey.mp3",heading:215.29,position:Cesium.Cartesian3.fromDegrees(128.242844,26.6799939,300),type:"noise",point:{color:Cesium.Color.RED.withAlpha(.4),pixelSize:t,translucencyByDistance:new Cesium.NearFarScalar(150,1,15e6,.2)}}),r.entities.add({id:8,name:"2017年3月30日15:40録音、砂辺、戦闘機",name_en:"recorded 15:40 March 30th 2017 at Sunabe, Fighters",file:"170330_sunabepark.mp3",heading:35.32,position:Cesium.Cartesian3.fromDegrees(127.7453168,26.3334472,300),type:"noise",point:{color:Cesium.Color.RED.withAlpha(.4),pixelSize:t,translucencyByDistance:new Cesium.NearFarScalar(150,1,15e6,.2)}})},1e3)}})}})}})}})}});var c=[];function u(e,i,a,n,o,t){this.label=e,this.lat=i,this.lng=a,this.heading=n,this.pitch=o,this.range=t}function m(a){a.id.fov;var t=a.id.position._value;f=t;var s=a.id.heading;s;a.id.pitch,a.id.roll,a.id.photoUrl,a.id.fov;!function(a){p.innerHTML=null;var o=Cesium.Ellipsoid.WGS84.cartesianToCartographic(f),t=new google.maps.LatLng(Cesium.Math.toDegrees(o.latitude),Cesium.Math.toDegrees(o.longitude)),s={enableCloseButton:!1,addressControl:!1,panControl:!0,panControlOptions:{position:google.maps.ControlPosition.TOP_CENTER},zoomControl:!1};e.getPanoramaByLocation(t,200,function(e,n){n!=google.maps.StreetViewStatus.OK?(svNotAvailable.innerHTML="この場所のストリートビューは利用できません",fadeInOut(svNotAvailable,1),setTimeout("fadeInOut(svNotAvailable,0)",1500)):($("#cesium").fadeOut(2800),$("#foot").fadeOut(2800),(i=new google.maps.StreetViewPanorama(p,{position:e.location.latLng,pov:{heading:a,pitch:15,zoom:1}})).setOptions(s),i.setVisible(!0))}),$(".btn-return").on("click",function(){$("#waveform").hide(),$(".btn-return").hide(),$("#foot").fadeIn("slow"),$("#cesium").fadeIn("slow"),n.pause(),r.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(127.9029728,25.8057773,7e4),orientation:{pitch:Cesium.Math.toRadians(-50)}})}),$(".btn-play").on("click",function(){n.play()})}(s),$("#wavedesc").text(a.id.name),$("#wavedesc_en").text(a.id.name_en),$("#waveform").show(),n.load("/audio/"+a.id.file),n.on("ready",function(){n.play()}),n.on("finish",function(){$("#waveform").hide(),$(".btn-return").hide(),$(".btn-play").hide(),$("#foot").fadeIn("slow"),$("#cesium").fadeIn("slow"),n.pause(),r.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(127.9029728,25.8057773,8e4),orientation:{pitch:Cesium.Math.toRadians(-50)}})}),$(".btn-return").show(),"sp"==o&&$(".btn-play").show()}c[0]=new u("オキナワ・サウンドデータ1（道の駅かでな）",26.3677858,127.7739129,0,5,0),c[1]=new u("オキナワ・サウンドデータ２（森川公園）",26.2704817,127.7403736,0,5,0),c[3]=new u("オキナワ・サウンドデータ４（新城・オスプレイMV22）",26.2856498,127.7717827,0,5,0),c[4]=new u("オキナワ・サウンドデータ５（砂辺、子供１）",26.3546692,127.7411702,0,5,0),c[5]=new u("オキナワ・サウンドデータ６（砂辺、子供２）",26.3539902,127.7434518,0,5,0),c[6]=new u("オキナワ・サウンドデータ７（上大謝名、オスプレイMV22）",26.2631028,127.7400556,0,5,0),c[7]=new u("2016年8月9日19:23録音、高江、MV-22 オスプレイ",26.6799013,128.2426576,0,5,0),c[8]=new u("2017年3月30日15:40録音、砂辺、戦闘機",26.3334472,127.7453168,0,5,0),new Cesium.ScreenSpaceEventHandler(r.canvas).setInputAction(function(e){var i=s.pick(e.position);if(null!=i)if("noise"==i.id.type){i.id.position._value;$(".cesium-infoBox").css("display","none"),r.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(c[i.id.id].lng,c[i.id.id].lat,1e3),complete:function(){r.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(c[i.id.id].lng,c[i.id.id].lat,20),orientation:{heading:Cesium.Math.toRadians(c[i.id.id].heading),pitch:Cesium.Math.toRadians(c[i.id.id].pitch)},complete:function(){m(i)}})}})}else $(".cesium-infoBox").show()},Cesium.ScreenSpaceEventType.LEFT_DOWN);var p=document.getElementById("sv"),f={x:0,y:0,x:0};$(document).on("click",".about",function(){return $("#about").fadeIn(),!1}),$("#about").on("click",function(){return $("#about").fadeOut(),!1})}